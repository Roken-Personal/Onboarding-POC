// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model OnboardingRequest {
  id                  String   @id @default(uuid())
  tradingName         String
  contactName         String
  contactEmail        String
  contactPhone        String?
  companyAddress      String?  @db.Text
  industry            String?
  companySize         String?
  requestType         String?
  region              String?
  status              String   @default("New")
  assignedTeam        String?
  assignedUserId      String?
  completionPercentage Int     @default(0)
  referenceNumber     String  @unique
  notes               String? @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  createdBy           String?
  updatedBy           String?

  statusHistory       StatusHistory[]
  teamAssignments    TeamAssignment[]

  @@index([status])
  @@index([assignedTeam])
  @@index([referenceNumber])
  @@index([createdAt])
  @@map("onboarding_requests")
}

model RoutingRule {
  id          String   @id @default(uuid())
  ruleName    String
  priority    Int
  conditions  String   @db.Text // JSON stored as text
  assignedTeam String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@map("routing_rules")
}

model StatusHistory {
  id        String   @id @default(uuid())
  requestId String
  oldStatus String?
  newStatus String?
  changedBy String?
  changedAt DateTime @default(now())
  notes     String?  @db.Text

  request   OnboardingRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([requestId])
  @@map("status_history")
}

model TeamAssignment {
  id            String   @id @default(uuid())
  requestId     String
  teamName      String
  assignedUserId String?
  assignedAt    DateTime @default(now())
  status        String   @default("Pending")

  request       OnboardingRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([requestId])
  @@map("team_assignments")
}

